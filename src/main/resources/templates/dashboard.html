<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard</title>
  <style>
    :root {
      --primary-color: #4a90e2;
      --secondary-color: #f5f7fa;
      --text-color: #333;
      --bg-color: #f0f2f5;
      --card-bg: #ffffff;
      --border-color: #e0e0e0;
      --shadow: 0 4px 12px rgba(0,0,0,0.1);
      --spacing: 1rem;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background-color: var(--bg-color);
      margin: 0;
      padding: var(--spacing);
      color: var(--text-color);
    }

    .container {
      /* Увеличиваем ширину контейнера */
      width: 95%;
      max-width: 1600px;
      margin: 2rem auto;
      background-color: var(--card-bg);
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: 2rem;
    }

    h1, h2 {
      text-align: center;
      margin-bottom: var(--spacing);
      color: var(--primary-color);
    }

    section {
      margin-bottom: 2rem;
    }

    /* Делаем таблицу шире */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 1.5rem;
    }

    th, td {
      padding: 0.75rem;
      text-align: left;
      border: 1px solid var(--border-color);
      font-size: 0.9rem;
    }

    th {
      background-color: var(--secondary-color);
      font-weight: 600;
    }

    .nested-list {
      list-style: none;
      margin: 0;
      padding-left: 1rem;
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
    }

    .summary-item {
      background-color: var(--secondary-color);
      padding: 1rem;
      border-radius: 8px;
      text-align: center;
      font-size: 1.1rem;
      font-weight: bold;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>Dashboard</h1>

  <section id="drivers-section">
    <h2>Drivers</h2>
    <div id="drivers"></div>
  </section>

  <section id="trucks-section">
    <h2>Trucks</h2>
    <div id="trucks"></div>
  </section>

  <section id="orders-section">
    <h2>Orders</h2>
    <div id="orders"></div>
  </section>

  <section id="summary-section">
    <h2>Summary</h2>
    <div id="summary" class="summary-grid">
      <div class="summary-item">Total Drivers: <span id="countOfDrivers"></span></div>
      <div class="summary-item">Total Trucks: <span id="countOfTrucks"></span></div>
    </div>
  </section>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    fetch("/dashboard")
            .then(response => response.json())
            .then(data => renderDashboard(data))
            .catch(error => console.error("Ошибка:", error));
  });

  function renderDashboard(data) {
    renderDrivers(data.driverInfo);
    renderTrucks(data.truckInfo);
    renderOrders(data.orderTableInfo);
    document.getElementById("countOfDrivers").textContent = data.countOfDrivers || 0;
    document.getElementById("countOfTrucks").textContent = data.countOfTrucks || 0;
  }

  function renderDrivers(drivers) {
    const driversDiv = document.getElementById("drivers");
    let html = `<table>
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Number</th>
                      <th>Current City</th>
                      <th>Status</th>
                      <th>Truck Number</th>
                    </tr>
                  </thead>
                  <tbody>`;
    drivers.forEach(driver => {
      html += `<tr>
                 <td>${driver.name || ""}</td>
                 <td>${driver.number || ""}</td>
                 <td>${driver.currentCity || ""}</td>
                 <td>${driver.status || ""}</td>
                 <td>${driver.truckNumber || ""}</td>
               </tr>`;
    });
    html += `</tbody></table>`;
    driversDiv.innerHTML = html;
  }

  function renderTrucks(trucks) {
    const trucksDiv = document.getElementById("trucks");
    let html = `<table>
                  <thead>
                    <tr>
                      <th>Registration Number</th>
                      <th>Current City</th>
                      <th>Status</th>
                      <th>Drivers Info</th>
                    </tr>
                  </thead>
                  <tbody>`;
    trucks.forEach(truck => {
      let driversInfoHtml = "";
      if (truck.driversInfo) {
        driversInfoHtml += "<ul class='nested-list'>";
        for (const [name, num] of Object.entries(truck.driversInfo)) {
          driversInfoHtml += `<li>${name} (№ ${num})</li>`;
        }
        driversInfoHtml += "</ul>";
      }
      html += `<tr>
                 <td>${truck.registrationNumber || ""}</td>
                 <td>${truck.currentCity || ""}</td>
                 <td>${truck.status || ""}</td>
                 <td>${driversInfoHtml}</td>
               </tr>`;
    });
    html += `</tbody></table>`;
    trucksDiv.innerHTML = html;
  }

  function renderOrders(orders) {
    const ordersDiv = document.getElementById("orders");
    let html = `<table>
                  <thead>
                    <tr>
                      <th>Unique Number</th>
                      <th>Status</th>
                      <th>Route Points</th>
                      <th>Drivers</th>
                      <th>Trucks</th>
                    </tr>
                  </thead>
                  <tbody>`;
    orders.forEach(order => {
      // Формируем информацию о маршрутных точках
      let routePointsHtml = "";
      // ВАЖНО: ниже мы используем order.mainRoutePointInfo —
      // проверьте, что это совпадает с вашим JSON
      if (order.mainRoutePointInfo && order.mainRoutePointInfo.length > 0) {
        routePointsHtml += "<ul class='nested-list'>";
        order.mainRoutePointInfo.forEach(route => {
          routePointsHtml += `<li>
                                <strong>From:</strong> ${route.cityFrom}
                                <strong>To:</strong> ${route.cityTo}
                                <strong>Distance:</strong> ${route.distance} km`;
          if (route.cargoInfoDto) {
            routePointsHtml += `<br><em>Cargo: № ${route.cargoInfoDto.number}, Weight: ${route.cargoInfoDto.weight} kg</em>`;
          }
          routePointsHtml += `</li>`;
        });
        routePointsHtml += "</ul>";
      }

      let orderDriverHtml = "<ul class='nested-list'>";
      order.mainDriverInfo.forEach(driver => {
        orderDriverHtml += `<li>
                              ${driver.name} (№ ${driver.number}) -
                              ${driver.currentCity || ""} -
                              ${driver.status || ""} -
                              Truck: ${driver.truckNumber || ""}
                            </li>`;
      });
      orderDriverHtml += "</ul>";

      let orderTruckHtml = "<ul class='nested-list'>";
      order.mainTruckInfo.forEach(truck => {
        orderTruckHtml += `<li>
                             ${truck.registrationNumber} -
                             ${truck.currentCity || ""} -
                             ${truck.status || ""}
                           </li>`;
      });
      orderTruckHtml += "</ul>";

      html += `<tr>
                 <td>${order.uniqueNumber || ""}</td>
                 <td>${order.orderStatus || ""}</td>
                 <td>${routePointsHtml}</td>
                 <td>${orderDriverHtml}</td>
                 <td>${orderTruckHtml}</td>
               </tr>`;
    });
    html += `</tbody></table>`;
    ordersDiv.innerHTML = html;
  }
</script>
</body>
</html>





