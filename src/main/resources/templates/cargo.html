<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Order</title>
    <style>
        .form-container {
            margin-bottom: 20px;
        }

        .form-container label,
        .form-container input,
        .form-container select {
            display: block;
            margin: 5px 0;
        }

        #truck-drivers-container {
            margin-top: 20px;
        }

        .button {
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            cursor: pointer;
            margin-top: 10px;
        }

        .button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>

<!-- Form to input route points -->
<div class="form-container" id="route-point-form">
    <h3>Enter Route Points</h3>

    <label for="cityFrom">City From:</label>
    <input type="text" id="cityFrom" placeholder="Enter city from">

    <label for="cityTo">City To:</label>
    <input type="text" id="cityTo" placeholder="Enter city to">

    <label for="cargoName">Cargo Name:</label>
    <input type="text" id="cargoName" placeholder="Enter cargo name">

    <label for="cargoWeight">Cargo Weight:</label>
    <input type="number" id="cargoWeight" placeholder="Enter cargo weight">

    <label for="operationType">Operation Type:</label>
    <select id="operationType">
        <option value="LOADING">Loading</option>
        <option value="UNLOADING">Unloading</option>
    </select>

    <label for="distance">Distance:</label>
    <input type="number" id="distance" placeholder="Enter distance">

    <button class="button" onclick="submitRoutePoints()">Submit Route Points</button>
</div>

<!-- Form to display trucks and drivers -->
<div class="form-container" id="truck-drivers-container" style="display: none;">
    <h3>Select Trucks and Drivers</h3>

    <div id="driversList"></div>
    <div id="trucksList"></div>

    <button class="button" onclick="submitOrder()">Submit Order</button>
</div>

<script>
    // Function to submit route points and fetch available trucks and drivers
    function submitRoutePoints() {
        const cityFrom = document.getElementById("cityFrom").value;
        const cityTo = document.getElementById("cityTo").value;
        const cargoName = document.getElementById("cargoName").value;
        const cargoWeight = document.getElementById("cargoWeight").value;
        const operationType = document.getElementById("operationType").value;
        const distance = document.getElementById("distance").value;

        // Validate inputs
        if (!cityFrom || !cityTo || !cargoName || !cargoWeight || !operationType || !distance) {
            alert("Please fill in all fields.");
            return;
        }

        // Create the route point object
        const routePoint = {
            cityName: cityFrom,
            cityTo: cityTo,
            cargos: [{
                name: cargoName,
                weight: cargoWeight
            }],
            operationType: operationType,
            distance: distance
        };

        // Send the route point data to the backend
        fetch("/api/orders/trucks-drivers", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify([routePoint]) // Send an array of route points
        })
            .then(response => response.json())
            .then(data => {
                displayAvailableVehicles(data); // Display the trucks and drivers
                document.getElementById("route-point-form").style.display = "none";
                document.getElementById("truck-drivers-container").style.display = "block";
            })
            .catch(error => {
                console.error("Error:", error);
                alert("An error occurred while fetching trucks and drivers.");
            });
    }

    // Function to display the available trucks and drivers
    function displayAvailableVehicles(data) {
        const driversList = document.getElementById("driversList");
        const trucksList = document.getElementById("trucksList");

        // Clear previous lists
        driversList.innerHTML = '';
        trucksList.innerHTML = '';

        // Display drivers
        data.drivers.forEach(driver => {
            driversList.innerHTML += `
                    <input type="checkbox" id="driver-${driver.id}" value="${driver.id}">
                    <label for="driver-${driver.id}">${driver.name} ${driver.secondName}</label><br>
                `;
        });

        // Display trucks
        data.trucks.forEach(truck => {
            trucksList.innerHTML += `
                    <input type="checkbox" id="truck-${truck.id}" value="${truck.id}">
                    <label for="truck-${truck.id}">${truck.registrationNumber}</label><br>
                `;
        });
    }

    // Function to submit the order with selected trucks and drivers
    function submitOrder() {
        const selectedDrivers = [];
        const selectedTrucks = [];

        // Get selected drivers
        const driverCheckboxes = document.querySelectorAll('input[type="checkbox"][id^="driver-"]:checked');
        driverCheckboxes.forEach(checkbox => {
            selectedDrivers.push(checkbox.value);
        });

        // Get selected trucks
        const truckCheckboxes = document.querySelectorAll('input[type="checkbox"][id^="truck-"]:checked');
        truckCheckboxes.forEach(checkbox => {
            selectedTrucks.push(checkbox.value);
        });

        if (selectedDrivers.length === 0 || selectedTrucks.length === 0) {
            alert("Please select at least one driver and one truck.");
            return;
        }

        const orderData = {
            driversId: selectedDrivers,
            trucksId: selectedTrucks
        };

        // Send the order data to the backend
        fetch("/create-order", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(orderData)
        })
            .then(response => response.json())
            .then(data => {
                alert("Order created successfully!");
            })
            .catch(error => {
                console.error("Error creating order:", error);
                alert("Error creating order.");
            });
    }
</script>

</body>
</html>







